<div id="import-container" class="container">

  <div>
    <acme-navbar></acme-navbar>
  </div>

  <h1>{{ pageTitle }}</h1>

  <div class="row">
    <div class="col-md-3">

      <!-- Error messages -->
      <uib-alert ng-repeat="(key, value) in import.alerts.getAll()" type="{{value}}"
                 close="import.alerts.remove(key)">{{key}}
      </uib-alert>

      <!-- Upload box -->
      <div nv-file-drop data-uploader="import.uploader" ng-click="import.clickUpload();"
           ng-show="import.uploader.isHTML5">
        <div nv-file-over data-uploader="import.uploader" class="well my-drop-zone text-center upload-box">
          <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span><br/>
          <div><strong>Choose files</strong></div>
          <div>or drag them here.</div>
        </div>
      </div>
      <input type="file" id="uploadBtn" ng-hide="import.uploader.isHTML5" multiple nv-file-select
             data-uploader="import.uploader">

      <!-- Upload accordion settings-->
      <div class="checkbox" ng-show="import.uploader.queue.length">
        <div class="well">
          <label>
            <input type="checkbox" ng-model="import.showOneUploadAtATime">
            Collapse other upload items
          </label>
        </div>
      </div>
    </div>

    <div class="col-md-9">

      <h3>Upload queue</h3>
      <p>Queue length: {{ import.uploader.queue.length }}</p>

      <form name="form" class="css-form">
        <uib-accordion close-others="import.showOneUploadAtATime">
          <uib-accordion-group heading="{{upload.file.name}}" ng-init="isOpen = $index === 0" is-open="isOpen"
                               ng-repeat="upload in import.uploader.queue">

            <div class="col-md-6">
              <div class="form-group" ng-if="!import.isModelUpload">
                <label for="dataType">Data Type</label>
                <select id="dataType" class="form-control" ng-model="import.data[$index].dataType"
                        ng-change="import.clearGeoPicker($index)" name="dataType_{{$index}}" required>
                  <option ng-repeat="dataType in dataTypes" value="{{dataType.name}}">
                    {{dataType.clearName}}
                  </option>
                </select>
              </div>

              <div class="form-group"
                   ng-if="import.data[$index].dataType && import.data[$index].dataType === import.TIME_SERIES">
                <div class="geo-picker" ng-model="import.geoPicker">
                  <label>
                    Geo-Coords
                    <span class="input-group">
                      <input type="text" placeholder="LAT" min="-90" max="90"
                             class="form-control" ng-model="import.data[$index].lat" name="lat_{{$index}}"
                             ng-required="import.data[$index].dataType
                             && import.data[$index].dataType === import.TIME_SERIES">
                      <span class="input-group-btn" style="width:0;"></span>
                      <input type="text" placeholder="LON" min="-180" max="180"
                             class="form-control" ng-model="import.data[$index].lng" name="lng_{{$index}}"
                             ng-required="import.data[$index].dataType
                             && import.data[$index].dataType === import.TIME_SERIES">
                      <span class="input-group-btn" style="width:0;"></span>
                      <span class="input-group-btn">
                        <button type="button" class="btn btn-primary"
                                ng-click="import.openGeoPicker($index)">pick</button>
                      </span>
                    </span>
                  </label>
                </div>
                <div ng-show="form.$submitted || form.lat_$index.$touched || form.lng_$index.$touched">
                  <div ng-show="form.lat_$index.$error.required || form.lng_$index.$error.required">
                    Please select a Geo Coordinate
                  </div>
                  <div ng-show="form.lat_$index.$error.min || form.lat_$index.$error.max">
                    Latitude is not valid! Valid range: -90 to 90.
                  </div>
                  <div ng-show="form.lng_$index.$error.min || form.lng_$index.$error.max">
                    Longitude is not valid. Valid range: -180 to 180.
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="privacy">Privacy</label>
                <select id="privacy" class="form-control" ng-model="import.data[$index].privacy"
                        name="privacy_{{$index}}" required>
                  {{import.data[$index].privacy= 'PRIVATE'}}
                  <option value="PRIVATE">Only for personal use</option>
                  <option value="PROJECT_PRIVATE">Can only be used by project members</option>
                  <option value="PUBLIC">Can be used by everyone</option>
                </select>
              </div>

              <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" class="form-control" ng-model="import.data[$index].title"
                       placeholder="Title of this data" data-ng-trim="true" name="title_{{$index}}" required>
              </div>

              <div class="form-group">
                <label>Description</label>
                <textarea class="form-control" rows="4" ng-model="import.data[$index].description"
                          placeholder="Description of this data"></textarea>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group" ng-show="import.uploader.isHTML5">
                <label class="control-label">File size:</label>
                {{ upload.file.size/1024/1024|number:2 }} MB
              </div>

              <div ng-show="import.uploader.isHTML5">
                <div ng-hide="upload.isSuccess || upload.isCancel || upload.isError" class="progress"
                     style="margin-bottom: 0;">
                  <div class="progress-bar" role="progressbar" ng-style="{ 'width': upload.progress + '%' }">
                    {{upload.progress}}% Complete
                  </div>
                </div>
                <div class="alert alert-warning" ng-if="upload.isUploading">
                  <i class="glyphicon glyphicon-refresh"></i> uploading
                </div>
                <div class="alert alert-info" ng-if="upload.isProcessing && !upload.isError && !upload.isCancel">
                  <i class="glyphicon glyphicon-refresh"></i> processing
                </div>
                <div class="alert alert-success" ng-if="!upload.isProcessing && upload.isSuccess">
                  <i class="glyphicon glyphicon-ok"></i> success
                </div>
                <div class="alert alert-warning" ng-if="upload.isCancel">
                  <i class="glyphicon glyphicon-ban-circle"></i> canceled
                </div>
                <div class="alert alert-danger" ng-if="upload.isError">
                  <i class="glyphicon glyphicon-remove"></i> failed
                </div>
              </div>
              <button type="button" class="btn btn-warning btn-xs" ng-click="upload.cancel()"
                      ng-disabled="!upload.isUploading">
                <span class="glyphicon glyphicon-ban-circle"></span> Cancel
              </button>
              <button type="button" class="btn btn-danger btn-xs"
                      ng-click="upload.remove(); import.removeUpload($index);">
                <span class="glyphicon glyphicon-trash"></span> Remove
              </button>
            </div>
          </uib-accordion-group>
        </uib-accordion>

        <div ng-show="import.uploader.queue.length">
          <button type="submit" class="btn btn-success btn-s" ng-click="import.uploadFiles()"
                  ng-disabled="form.$invalid">
            <span class="glyphicon glyphicon-upload"></span> Upload
          </button>
          <button type="button" class="btn btn-warning btn-s" ng-click="import.uploader.cancelAll()"
                  ng-disabled="!import.uploader.isUploading">
            <span class="glyphicon glyphicon-ban-circle"></span> Cancel
          </button>
          <button type="button" class="btn btn-danger btn-s"
                  ng-click="import.uploader.clearQueue(); import.removeAllUploads();"
                  ng-disabled="!import.uploader.queue.length">
            <span class="glyphicon glyphicon-trash"></span> Remove all
          </button>
        </div>
      </form>

    </div>
  </div>

</div>
